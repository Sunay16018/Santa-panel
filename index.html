<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Account Panel</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

<div id="tabs">
    <button class="plus-btn" onclick="addBot()">YENİ HESAP +</button>
</div>

<div id="bot-panels"></div>

<script>
    const socket = io();
    let botCount = 0;
    let activeBotId = 0;

    function addBot() {
        botCount++;
        const id = botCount;

        const btn = document.createElement('button');
        btn.className = 'tab-btn';
        btn.id = `tbtn-${id}`;
        btn.innerText = `Hesap ${id}`;
        btn.onclick = () => showBot(id);
        document.querySelector('.plus-btn').before(btn);

        const panel = document.createElement('div');
        panel.className = 'container';
        panel.id = `panel-${id}`;
        panel.style.display = 'none';
        panel.innerHTML = `
            <h3>HESAP ${id}</h3>
            <input id="host-${id}" placeholder="IP:Port">
            <input id="user-${id}" placeholder="Bot Adı">
            <button onclick="join(${id})" class="main-btn">BAĞLAN</button>
            <div id="log-${id}" class="log-box"></div>
            <input id="msg-${id}" placeholder="Mesaj veya Komut..." onkeypress="if(event.key==='Enter')send(${id})">
            <div class="controls">
                <button onmousedown="move(${id},'forward',true)" onmouseup="move(${id},'forward',false)" ontouchstart="move(${id},'forward',true)" ontouchend="move(${id},'forward',false)">▲</button>
                <button onmousedown="move(${id},'left',true)" onmouseup="move(${id},'left',false)" ontouchstart="move(${id},'left',true)" ontouchend="move(${id},'left',false)">◀</button>
                <button onmousedown="move(${id},'back',true)" onmouseup="move(${id},'back',false)" ontouchstart="move(${id},'back',true)" ontouchend="move(${id},'back',false)">▼</button>
                <button onmousedown="move(${id},'right',true)" onmouseup="move(${id},'right',false)" ontouchstart="move(${id},'right',true)" ontouchend="move(${id},'right',false)">▶</button>
                <button onclick="jump(${id})" style="grid-column: span 2; background:#2980b9;">ZIPLA</button>
            </div>
        `;
        document.getElementById('bot-panels').appendChild(panel);
        showBot(id);
    }

    function showBot(id) {
        activeBotId = id;
        document.querySelectorAll('.container').forEach(p => p.style.display = 'none');
        document.getElementById(`panel-${id}`).style.display = 'block';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`tbtn-${id}`).classList.add('active');
    }

    function join(id) {
        const hostFull = document.getElementById(`host-${id}`).value.split(':');
        const host = hostFull[0];
        const port = hostFull[1] || "25565";
        const username = document.getElementById(`user-${id}`).value;
        socket.emit('join', { botId: id, host, port, username });
    }

    function send(id) {
        const input = document.getElementById(`msg-${id}`);
        if (!input.value) return;
        socket.emit('send-chat', { botId: id, msg: input.value });
        input.value = "";
    }

    function move(id, dir, state) { socket.emit('move', { botId: id, dir, state }); }
    function jump(id) { move(id, 'jump', true); setTimeout(() => move(id, 'jump', false), 250); }

    socket.on('log', (data) => {
        const log = document.getElementById(`log-${data.botId}`);
        if(log) {
            log.innerHTML += `<div>${data.msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }
    });

    addBot();
</script>
</body>
</html>
