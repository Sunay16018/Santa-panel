<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santa Multi-Panel V2</title>
    <link rel="stylesheet" href="style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div id="tabs"><button class="plus-btn" onclick="addBot()">YENİ HESAP +</button></div>
<div id="bot-panels"></div>
<script>
    const socket = io();
    let botCount = 0;
    function addBot() {
        botCount++; const id = botCount;
        const btn = document.createElement('button');
        btn.className = 'tab-btn'; btn.id = `tbtn-${id}`; btn.innerText = `Hesap ${id}`;
        btn.onclick = () => showBot(id);
        document.querySelector('.plus-btn').before(btn);
        const panel = document.createElement('div');
        panel.className = 'container'; panel.id = `panel-${id}`;
        panel.innerHTML = `
            <h3>HESAP KONTROL #${id}</h3>
            <div class="row"><input id="host-${id}" placeholder="IP:Port"><input id="user-${id}" placeholder="Bot Adı"></div>
            <button onclick="join(${id})" class="main-btn">BAĞLAN</button>
            <div class="map-container">
                <div id="map-${id}" class="map-pixel"><div id="player-${id}" class="player-dot"></div></div>
                <div id="coords-${id}" class="coords">X: 0, Y: 0, Z: 0</div>
            </div>
            <div id="log-${id}" class="log-box"></div>
            <div class="auto-msg-box">
                <input id="automsg-${id}" placeholder="Oto mesaj...">
                <div class="row">
                    <input id="autotime-${id}" type="number" placeholder="Süre" style="width:60px">
                    <select id="autounit-${id}"><option value="sec">Sn</option><option value="min">Dk</option><option value="hour">Sa</option></select>
                    <button onclick="setAutoMsg(${id}, true)">BAŞLAT</button>
                    <button onclick="setAutoMsg(${id}, false)" style="background:#c0392b">DUR</button>
                </div>
            </div>
            <input id="msg-${id}" placeholder="Mesaj gönder..." onkeypress="if(event.key==='Enter')send(${id})">
            <div class="controls">
                <button onmousedown="move(${id},'forward',true)" onmouseup="move(${id},'forward',false)">▲</button>
                <button onmousedown="move(${id},'left',true)" onmouseup="move(${id},'left',false)">◀</button>
                <button onmousedown="move(${id},'back',true)" onmouseup="move(${id},'back',false)">▼</button>
                <button onmousedown="move(${id},'right',true)" onmouseup="move(${id},'right',false)">▶</button>
                <button onclick="jump(${id})" style="grid-column: span 2; background:#2980b9;">ZIPLA</button>
            </div>`;
        document.getElementById('bot-panels').appendChild(panel); showBot(id);
    }
    function showBot(id) {
        document.querySelectorAll('.container').forEach(p => p.style.display = 'none');
        document.getElementById(`panel-${id}`).style.display = 'block';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`tbtn-${id}`).classList.add('active');
    }
    function join(id) {
        const host = document.getElementById(`host-${id}`).value.split(':');
        socket.emit('join', { botId: id, host: host[0], port: host[1] || 25565, username: document.getElementById(`user-${id}`).value });
    }
    function setAutoMsg(id, active) {
        socket.emit('set-auto-msg', { botId: id, active, msg: document.getElementById(`automsg-${id}`).value, time: document.getElementById(`autotime-${id}`).value, unit: document.getElementById(`autounit-${id}`).value });
    }
    function send(id) { const inp = document.getElementById(`msg-${id}`); socket.emit('send-chat', { botId: id, msg: inp.value }); inp.value = ""; }
    function move(id, dir, state) { socket.emit('move', { botId: id, dir, state }); }
    function jump(id) { move(id, 'jump', true); setTimeout(() => move(id, 'jump', false), 250); }
    socket.on('pos', (data) => {
        const dot = document.getElementById(`player-${data.botId}`);
        const coords = document.getElementById(`coords-${data.botId}`);
        if(dot && coords) {
            coords.innerText = `X: ${data.x}, Y: ${data.y}, Z: ${data.z}`;
            dot.style.left = (50 + (data.x % 40)) + "%"; dot.style.top = (50 + (data.z % 40)) + "%";
        }
    });
    socket.on('log', (data) => {
        const log = document.getElementById(`log-${data.botId}`);
        if(log) { log.innerHTML += `<div>${data.msg}</div>`; log.scrollTop = log.scrollHeight; }
    });
    addBot();
</script>
</body>
</html>
